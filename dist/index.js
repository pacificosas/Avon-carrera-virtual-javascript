!function(){"use strict";var e="https://apps.pacificamello.com/avonUtilidades/api/v1/";const t=e=>({target:t})=>{const n=Array.from(t.querySelectorAll("option")).find((e=>e.value===t.value));e(n.getAttribute("data-id")||"",n)},n=e=>{const t=document.createElement("option");return t.value="",t.innerHTML=e,t},a=async(t,n,{fromId:a,country:o,defaultLabel:s}={})=>{try{const c=a?`fromId=${a}&country=${o}`:`country=${o}`,l=await fetch(`${e}geography/${n}?${c}`),i=(await l.json()).payload.map((e=>{const t=document.createElement("option");return t.value=e.name,t.innerHTML=e.name,t.setAttribute("data-id",e.id),t}));r(t,s),i.forEach((e=>t.append(e)))}catch(e){console.warm(e)}},r=(e,t)=>{e.innerHTML="",e.append(n(t))},o=e=>{e.forEach((e=>r(e.element,e.defaultLabel)))};var s=e=>`pacifica__${e}`;const c=async(t,n)=>{try{const a=await fetch(`${e}/representatives/${n}?code=${t}`);let{payload:r}=await a.json();return r&&(r={...r,hasOrder:await l(r.id)},sessionStorage.setItem(s("rep"),JSON.stringify(r))),r}catch(e){console.warn(e)}},l=async t=>{try{const n=await fetch(`${e}/reporders/${t}`),{payload:a}=await n.json();return a}catch(e){console.warn(e)}};var i={getRep:c,getRepOnForm:({loading:e,err:t,country:n,form:a,input:r}={},o)=>{a.addEventListener("submit",(async a=>{a.preventDefault();const s=r.value;if(!s)return;e&&(e.style.display="block"),t&&(t.style.display="none");const l=await c(s,n);e&&(e.style.display="none"),t&&!l&&(t.style.display="block"),o(l)}))},formAutoComplete:(e,t={})=>{const n=JSON.parse(sessionStorage.getItem(s("rep")));if(!n)return null;for(const a in t){const r=e.querySelector(`[name=${a}]`),o=t[a],s=n[o];r&&o&&s&&(r.value=s)}},getLocalRep:()=>JSON.parse(sessionStorage.getItem(s("rep"))),setOrder:()=>{const t=JSON.parse(sessionStorage.getItem(s("rep")));t&&(async t=>{try{const n=await fetch(`${e}/reporders/${t}`,{method:"POST"}),{payload:a}=await n.json()}catch(e){console.warn(e)}})(t.id)}};const u=e=>e.reduce(((e,t)=>e+parseInt(t.querySelector("[type=number]").value)),0),p=e=>({[e.querySelector("label").innerText]:e.querySelector("input[type=number]").value}),d=({section:e,inputs:t})=>({[e.querySelector("label").innerText]:t.reduce(((e,t)=>({...e,...p(t)})),{})}),m=(e,t,n,a)=>n===a?(e.value=JSON.stringify((e=>e.reduce(((e,t)=>({...e,...d(t)})),{}))(t)),!0):(e.value=null,!1);var f={sizeForm:({form:e,sizes:t,classes:n,max:a,formInput:r,errCb:o})=>{const s=document.createElement("div");s.setAttribute("class",n.container);const c=t.sections.map((e=>((e,t,n)=>{const a=document.createElement("div");a.setAttribute("class",n.sectionContainer);const r=document.createElement("label");r.setAttribute("class",n.title),r.innerHTML=e;const o=document.createElement("div");o.setAttribute("class",n.inputsContainer);const s=t.map((e=>((e,t)=>{const n=`\n<div class="quantity">\n  <label class="${t}">${e}</label>\n  <input type="button" value="-" class="minus">\n  <input type="number" class="input-text qty text" step="1" min="0" max="" value="0" >\n  <input type="button" value="+" class="plus">\n</div>\n  `,a=document.createElement("DIV");return a.innerHTML=n,a})(e,n.inputLabel)));return s.forEach((e=>o.append(e))),a.append(r),a.append(o),{section:a,inputs:s}})(e,t.sizes,n))),l=c.reduce(((e,t)=>[...e,...t.inputs]),[]);return l.forEach((e=>{const t=e.querySelector("input[value='+']"),n=e.querySelector("input[value='-']"),i=e.querySelector("input[type=number]");n.addEventListener("click",(e=>{let t=u(l);parseInt(i.value)>0&&(i.value=parseInt(i.value)-1,t-=1);const n=m(r,c,t,a);"function"==typeof o&&o(!n,s)})),t.onclick=e=>{e.stopPropagation();const t=u(l)+1;if(t>a)return null;i.value=parseInt(i.value)+1;const n=m(r,c,t,a);"function"==typeof o&&o(!n,s)}})),c.forEach((e=>s.append(e.section))),s}};window.pacifica_geo=({country:e,levels:r}={})=>{if(0===r.length)throw new Error("pacifica_geo: should specified at leat 1 scale level");if(r.length>3)throw new Error("pacifica_geo: should specified max 3 scale levels");var s;r.forEach=e=>{e.select.append(n(e.defaultLabel))},s=r[0],a(s.element,"departments",{country:e,defaultLabel:s.defaultLabel}),r[1]&&(r[0].element.addEventListener("change",t(((t,n)=>r=>{if(!r)return o(n);a(t.element,"cities",{fromId:r,country:e,defaultLabel:t.defaultLabel})})(r[1],r.slice(1)))),r[1].element.append(n(r[1].defaultLabel))),r[2]&&(r[1].element.addEventListener("change",t(((t,n)=>r=>{if(!r)return o(n);a(t.element,"towns",{fromId:r,country:e,defaultLabel:t.defaultLabel})})(r[2],r.slice(2)))),r[2].element.append(n(r[2].defaultLabel)))},window.pacifica_rep=i,window.pacifica_prod=f}();