!function(){"use strict";var e="https://apps.pacificamello.com/avonUtilidades/api/v1/";const t=(e,t)=>e<t?-1:t<e?1:0,n=e=>({target:t})=>{const n=Array.from(t.querySelectorAll("option")).find((e=>e.value===t.value));e(n.getAttribute("data-id")||"",n)},a=e=>{const t=document.createElement("option");return t.value="",t.innerHTML=e,t},r=async(n,a,{fromId:r,country:s,defaultLabel:l}={})=>{try{const i=(c=e=>e.name,e=>t=>t.sort(((t,n)=>e(c(t),c(n)))))(t),u=r?`fromId=${r}&country=${s}`:`country=${s}`,p=await fetch(`${e}geography/${a}?${u}`),d=i((await p.json()).payload).map((e=>{const t=document.createElement("option");return t.value=e.name,t.innerHTML=e.name,t.setAttribute("data-id",e.id),t}));o(n,l),d.forEach((e=>n.append(e)))}catch(e){console.warm(e)}var c},o=(e,t)=>{e.innerHTML="",e.append(a(t))},s=e=>{e.forEach((e=>o(e.element,e.defaultLabel)))};var l=e=>`pacifica__${e}`;const c=async(t,n)=>{try{const a=await fetch(`${e}/representatives/${n}?code=${t}`);let{payload:r}=await a.json();return r&&(r={...r,hasOrder:await i(r.id)},sessionStorage.setItem(l("rep"),JSON.stringify(r))),r}catch(e){console.warn(e)}},i=async t=>{try{const n=await fetch(`${e}/reporders/${t}`),{payload:a}=await n.json();return a}catch(e){console.warn(e)}};var u={getRep:c,getRepOnForm:({loading:e,err:t,country:n,form:a,input:r}={},o)=>{a.addEventListener("submit",(async a=>{a.preventDefault();const s=r.value;if(!s)return;e&&(e.style.display="block"),t&&(t.style.display="none");const l=await c(s,n);e&&(e.style.display="none"),t&&!l&&(t.style.display="block"),o(l)}))},formAutoComplete:(e,t={})=>{const n=JSON.parse(sessionStorage.getItem(l("rep")));if(!n)return null;for(const a in t){const r=e.querySelector(`[name=${a}]`),o=t[a],s=n[o];r&&o&&s&&(r.value=s)}},getLocalRep:()=>JSON.parse(sessionStorage.getItem(l("rep"))),setOrder:async()=>{const t=JSON.parse(sessionStorage.getItem(l("rep")));t&&await(async t=>{try{const n=await fetch(`${e}/reporders/${t}`,{method:"POST"}),{payload:a}=await n.json();return a}catch(e){console.warn(e)}})(t.id)}};const p=e=>e.reduce(((e,t)=>e+parseInt(t.querySelector("[type=number]").value)),0),d=e=>({[e.querySelector("label").innerText]:e.querySelector("input[type=number]").value}),m=({section:e,inputs:t})=>({[e.querySelector("label").innerText]:t.reduce(((e,t)=>({...e,...d(t)})),{})}),f=(e,t,n,a)=>n===a?(e.value=JSON.stringify((e=>e.reduce(((e,t)=>({...e,...m(t)})),{}))(t)),!0):(e.value=null,!1);var y={sizeForm:({form:e,sizes:t,classes:n,max:a,formInput:r,errCb:o})=>{const s=document.createElement("div");s.setAttribute("class",n.container);const l=t.sections.map((e=>((e,t,n)=>{const a=document.createElement("div");a.setAttribute("class",n.sectionContainer);const r=document.createElement("label");r.setAttribute("class",n.title),r.innerHTML=e;const o=document.createElement("div");o.setAttribute("class",n.inputsContainer);const s=t.map((e=>((e,t)=>{const n=`\n<div class="quantity">\n  <label class="${t}">${e}</label>\n  <input type="button" value="-" class="minus">\n  <input type="number" class="input-text qty text" step="1" min="0" max="" value="0" >\n  <input type="button" value="+" class="plus">\n</div>\n  `,a=document.createElement("DIV");return a.innerHTML=n,a})(e,n.inputLabel)));return s.forEach((e=>o.append(e))),a.append(r),a.append(o),{section:a,inputs:s}})(e,t.sizes,n))),c=l.reduce(((e,t)=>[...e,...t.inputs]),[]);return c.forEach((e=>{const t=e.querySelector("input[value='+']"),n=e.querySelector("input[value='-']"),i=e.querySelector("input[type=number]");n.addEventListener("click",(e=>{let t=p(c);parseInt(i.value)>0&&(i.value=parseInt(i.value)-1,t-=1);const n=f(r,l,t,a);"function"==typeof o&&o(!n,s)})),t.onclick=e=>{e.stopPropagation();const t=p(c)+1;if(t>a)return null;i.value=parseInt(i.value)+1;const n=f(r,l,t,a);"function"==typeof o&&o(!n,s)}})),l.forEach((e=>s.append(e.section))),s}};window.pacifica_geo=({country:e,levels:t}={})=>{if(0===t.length)throw new Error("pacifica_geo: should specified at leat 1 scale level");if(t.length>3)throw new Error("pacifica_geo: should specified max 3 scale levels");var o;if(t.forEach=e=>{e.select.append(a(e.defaultLabel))},"pe"!==e&&(o=t[0],r(o.element,"departments",{country:e,defaultLabel:o.defaultLabel})),"pe"===e){const e=[document.createElement("option"),document.createElement("option")];e[0].innerHTML="LIMA",e[0].setAttribute("values","LIMA"),e[0].setAttribute("data-id","44"),e[1].innerHTML="CALLAO",e[1].setAttribute("values","CALLAO"),e[1].setAttribute("data-id","46"),t[0].element.append(a(t[0].defaultLabel)),e.forEach((e=>t[0].element.append(e)))}t[1]&&(t[0].element.addEventListener("change",n(((t,n)=>a=>{if(!a)return s(n);r(t.element,"cities",{fromId:a,country:e,defaultLabel:t.defaultLabel})})(t[1],t.slice(1)))),t[1].element.append(a(t[1].defaultLabel))),t[2]&&(t[1].element.addEventListener("change",n(((t,n)=>a=>{if(!a)return s(n);r(t.element,"towns",{fromId:a,country:e,defaultLabel:t.defaultLabel})})(t[2],t.slice(2)))),t[2].element.append(a(t[2].defaultLabel)))},window.pacifica_rep=u,window.pacifica_prod=y}();